query ClassesList {
  classes {
    id
    group {
      name
      user_groups_aggregate {
        aggregate {
          count
        }
      }
    }
    subject {
      title
    }
  }
}

subscription ClassDetail($id: Int!) {
  class: classes_by_pk(id: $id) {
    subject {
      title
    }
    group {
      name
      homeroom_teacher {
        full_name
      }
      user_groups {
        user {
          id
          full_name
          grades(where: { class_id: { _eq: $id } }) {
            id
            value
            weight
            added_on
            comment
          }
        }
      }
    }
  }
}

query ClassAttendace($class_id: Int!, $date: date!) {
  class: classes_by_pk(id: $class_id) {
    subject {
      title
    }
    group {
      name
      user_groups {
        user {
          id
          full_name
          attendances(
            where: { class_id: { _eq: $class_id }, date: { _eq: $date } }
          ) {
            type
          }
        }
      }
    }
  }
}

mutation InsertAttendance($att: [attendance_insert_input!]!) {
  insert_attendance(
    objects: $att
    on_conflict: {
      constraint: attendance_student_id_date_period_id_key
      update_columns: type
    }
  ) {
    affected_rows
    returning {
      id
    }
  }
}
