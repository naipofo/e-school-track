subscription GetMessages($user_id: Int!) {
  messages(
    order_by: { sent_on: desc }
    where: { recipients: { user_id: { _eq: $user_id } } }
  ) {
    id
    title
    sender {
      full_name
    }
    inbox_entries(where: { user_id: { _eq: $user_id } }) {
      read_receipt
    }
  }
}

mutation ReadMessage($id: Int!, $user_id: Int!) {
  inbox: insert_inbox_entries_one(
    object: { message_id: $id, read_receipt: true, user_id: $user_id }
  ) {
    message {
      title
      content
      sender {
        id
        full_name
      }
    }
  }
}

query GetPossibleRecipients {
  users {
    id
    full_name
  }
  groups {
    id
    name
    user_groups {
      user {
        full_name
      }
    }
  }
}

mutation SendMessage(
  $recipient_users: _int4!
  $recipient_groups: _int4!
  $title: String!
  $content: String!
) {
  send_message(
    args: {
      content: $content
      recepient_groups: $recipient_groups
      recipient_users: $recipient_users
      title: $title
    }
  ) {
    id
  }
}
